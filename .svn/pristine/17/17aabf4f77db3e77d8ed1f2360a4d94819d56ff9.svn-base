import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;
import java.util.Scanner;

import java.io.*;
import java.nio.file.Files;

public class ContentServer {

    public static void main(String[] args) throws Exception {

        Parser parser = new Parser();

        if (args.length != 1) {
            System.err.println("Pass the server IP as the sole command line argument");
            return;
        }
        
        for(int i=0;i<3;i++) {
            try {
                var socket = new Socket(args[0], 59898);
                System.out.println("Reading lines. Ctrl+D or Ctrl+C to quit");

                var in = new Scanner(socket.getInputStream());
                var out = new PrintWriter(socket.getOutputStream(), true);
                out.println("PUT");
                out.println(parser.parse("content1.txt"));

                while (in.hasNextLine()) {

                    System.out.println(in.nextLine());
                }

            }
            catch (Exception e) {
                System.out.println(e);
            }

            Thread.sleep(5000);
        }

        System.out.println("The server is not responding!!");
    }
}